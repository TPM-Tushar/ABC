/*!
 * bootstrap-typeahead.js v0.0.5 (http://www.upbootstrap.com)
 * Copyright 2012-2015 Twitter Inc.
 * Licensed under MIT (https://github.com/biggora/bootstrap-ajax-typeahead/blob/master/LICENSE)
 * See Demo: http://plugins.upbootstrap.com/bootstrap-ajax-typeahead
 * Updated: 2015-04-05 11:43:56
 *
 * Modifications by Paul Warelis and Alexey Gordeyev
 */
!function(n){"use strict";var t=function(t,i){var f=n.fn.typeahead.defaults,r,u;i.scrollBar&&(i.items=100,i.menu='<ul class="typeahead dropdown-menu" style="max-height:220px;overflow:auto;"><\/ul>');r=this;r.$element=n(t);r.options=n.extend({},n.fn.typeahead.defaults,i);r.$menu=n(r.options.menu).insertAfter(r.$element);r.eventSupported=r.options.eventSupported||r.eventSupported;r.grepper=r.options.grepper||r.grepper;r.highlighter=r.options.highlighter||r.highlighter;r.lookup=r.options.lookup||r.lookup;r.matcher=r.options.matcher||r.matcher;r.render=r.options.render||r.render;r.onSelect=r.options.onSelect||null;r.sorter=r.options.sorter||r.sorter;r.source=r.options.source||r.source;r.displayField=r.options.displayField||r.displayField;r.valueField=r.options.valueField||r.valueField;r.options.ajax?(u=r.options.ajax,typeof u=="string"?r.ajax=n.extend({},n.fn.typeahead.defaults.ajax,{url:u}):(typeof u.displayField=="string"&&(r.displayField=r.options.displayField=u.displayField),typeof u.valueField=="string"&&(r.valueField=r.options.valueField=u.valueField),r.ajax=n.extend({},n.fn.typeahead.defaults.ajax,u)),r.ajax.url||(r.ajax=null),r.query=""):(r.source=r.options.source,r.ajax=null);r.shown=!1;r.listen()};t.prototype={constructor:t,eventSupported:function(n){var t=n in this.$element;return t||(this.$element.setAttribute(n,"return;"),t=typeof this.$element[n]=="function"),t},select:function(){var t=this.$menu.find(".active"),i=t.attr("data-value"),n=this.$menu.find(".active a").text();if(this.options.onSelect)this.options.onSelect({value:i,text:n});return this.$element.val(this.updater(n)).change(),this.hide()},updater:function(n){return n},show:function(){var t=n.extend({},this.$element.position(),{height:this.$element[0].offsetHeight}),i;return this.$menu.css({top:t.top+t.height,left:t.left}),this.options.alignWidth&&(i=n(this.$element[0]).outerWidth(),this.$menu.css({width:i})),this.$menu.show(),this.shown=!0,this},hide:function(){return this.$menu.hide(),this.shown=!1,this},ajaxLookup:function(){function i(){this.ajaxToggleLoadClass(!0);this.ajax.xhr&&this.ajax.xhr.abort();var i=this.ajax.preDispatch?this.ajax.preDispatch(t):{query:t};this.ajax.xhr=n.ajax({url:this.ajax.url,data:i,success:n.proxy(this.ajaxSource,this),type:this.ajax.method||"get",dataType:"json"});this.ajax.timerId=null}var t=n.trim(this.$element.val());return t===this.query?this:(this.query=t,this.ajax.timerId&&(clearTimeout(this.ajax.timerId),this.ajax.timerId=null),!t||t.length<this.ajax.triggerLength)?(this.ajax.xhr&&(this.ajax.xhr.abort(),this.ajax.xhr=null,this.ajaxToggleLoadClass(!1)),this.shown?this.hide():this):(this.ajax.timerId=setTimeout(n.proxy(i,this),this.ajax.timeout),this)},ajaxSource:function(n){this.ajaxToggleLoadClass(!1);var t=this,i;if(t.ajax.xhr)return(t.ajax.preProcess&&(n=t.ajax.preProcess(n)),t.ajax.data=n,i=t.grepper(t.ajax.data)||[],!i.length)?t.shown?t.hide():t:(t.ajax.xhr=null,t.render(i.slice(0,t.options.items)).show())},ajaxToggleLoadClass:function(n){this.ajax.loadingClass&&this.$element.toggleClass(this.ajax.loadingClass,n)},lookup:function(){var n=this,t;if(n.ajax)n.ajaxer();else return(n.query=n.$element.val(),!n.query)?n.shown?n.hide():n:(t=n.grepper(n.source),!t)?n.shown?n.hide():n:(t.length==0&&(t[0]={id:-21,name:"Result not Found"}),n.render(t.slice(0,n.options.items)).show())},matcher:function(n){return~n.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(n){if(this.options.ajax)return n;for(var i=[],r=[],u=[],t;t=n.shift();)t.toLowerCase().indexOf(this.query.toLowerCase())?~t.indexOf(this.query)?r.push(t):u.push(t):i.push(t);return i.concat(r,u)},highlighter:function(n){var t=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return n.replace(new RegExp("("+t+")","ig"),function(n,t){return"<strong>"+t+"<\/strong>"})},render:function(t){var i=this,r,u=typeof i.options.displayField=="string";return t=n(t).map(function(t,f){return typeof f=="object"?(r=u?f[i.options.displayField]:i.options.displayField(f),t=n(i.options.item).attr("data-value",f[i.options.valueField])):(r=f,t=n(i.options.item).attr("data-value",f)),t.find("a").html(i.highlighter(r)),t[0]}),t.first().addClass("active"),this.$menu.html(t),this},grepper:function(t){var i=this,r,u,f=typeof i.options.displayField=="string";if(f&&t&&t.length)if(t[0].hasOwnProperty(i.options.displayField))r=n.grep(t,function(n){return u=f?n[i.options.displayField]:i.options.displayField(n),i.matcher(u)});else if(typeof t[0]=="string")r=n.grep(t,function(n){return i.matcher(n)});else return null;else return null;return this.sorter(r)},next:function(){var r=this.$menu.find(".active").removeClass("active"),t=r.next(),i;t.length||(t=n(this.$menu.find("li")[0]));this.options.scrollBar&&(i=this.$menu.children("li").index(t),i%8==0&&this.$menu.scrollTop(i*26));t.addClass("active")},prev:function(){var r=this.$menu.find(".active").removeClass("active"),n=r.prev();if(n.length||(n=this.$menu.find("li").last()),this.options.scrollBar){var t=this.$menu.children("li"),u=t.length-1,i=t.index(n);(u-i)%8==0&&this.$menu.scrollTop((i-7)*26)}n.addClass("active")},listen:function(){this.$element.on("focus",n.proxy(this.focus,this)).on("blur",n.proxy(this.blur,this)).on("keypress",n.proxy(this.keypress,this)).on("keyup",n.proxy(this.keyup,this));if(this.eventSupported("keydown"))this.$element.on("keydown",n.proxy(this.keydown,this));this.$menu.on("click",n.proxy(this.click,this)).on("mouseenter","li",n.proxy(this.mouseenter,this)).on("mouseleave","li",n.proxy(this.mouseleave,this))},move:function(n){if(this.shown){switch(n.keyCode){case 9:case 13:case 27:n.preventDefault();break;case 38:n.preventDefault();this.prev();break;case 40:n.preventDefault();this.next()}n.stopPropagation()}},keydown:function(t){this.suppressKeyPressRepeat=~n.inArray(t.keyCode,[40,38,9,13,27]);this.move(t)},keypress:function(n){this.suppressKeyPressRepeat||this.move(n)},keyup:function(n){switch(n.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();break;default:this.ajax?this.ajaxLookup():this.lookup()}n.stopPropagation();n.preventDefault()},focus:function(){this.focused=!0},blur:function(){this.focused=!1;!this.mousedover&&this.shown&&this.hide()},click:function(n){n.stopPropagation();n.preventDefault();this.select();this.$element.focus()},mouseenter:function(t){this.mousedover=!0;this.$menu.find(".active").removeClass("active");n(t.currentTarget).addClass("active")},mouseleave:function(){this.mousedover=!1;!this.focused&&this.shown&&this.hide()},destroy:function(){this.$element.off("focus",n.proxy(this.focus,this)).off("blur",n.proxy(this.blur,this)).off("keypress",n.proxy(this.keypress,this)).off("keyup",n.proxy(this.keyup,this));this.eventSupported("keydown")&&this.$element.off("keydown",n.proxy(this.keydown,this));this.$menu.off("click",n.proxy(this.click,this)).off("mouseenter","li",n.proxy(this.mouseenter,this)).off("mouseleave","li",n.proxy(this.mouseleave,this));this.$element.removeData("typeahead")}};n.fn.typeahead=function(i){return this.each(function(){var u=n(this),r=u.data("typeahead"),f=typeof i=="object"&&i;r||u.data("typeahead",r=new t(this,f));typeof i=="string"&&r[i]()})};n.fn.typeahead.defaults={source:[],items:10,scrollBar:!1,alignWidth:!0,menu:'<ul class="typeahead dropdown-menu"><\/ul>',item:'<li><a href="#"><\/a><\/li>',valueField:"id",displayField:"name",onSelect:function(){},ajax:{url:null,timeout:300,method:"get",triggerLength:1,loadingClass:null,preDispatch:null,preProcess:null}};n.fn.typeahead.Constructor=t;n(function(){n("body").on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(t){var i=n(this);i.data("typeahead")||(t.preventDefault(),i.typeahead(i.data()))})})}(window.jQuery);