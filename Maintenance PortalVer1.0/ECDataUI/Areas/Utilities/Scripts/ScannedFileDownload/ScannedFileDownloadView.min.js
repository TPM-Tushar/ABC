function LoadDT(){var n=$("#ScannedFileLogTableID").DataTable({ajax:{url:"/Utilities/ScannedFileDownload/LoadScannedFileDownloadLogTable",type:"POST",headers:header,data:{},dataSrc:function(n){if(unBlockUI(),n.errorMessage!=null)bootbox.alert({message:'<i class="fa fa-exclamation-triangle text-danger boot-icon boot-icon"><\/i><span class="boot-alert-txt">'+n.errorMessage+"<\/span>",callback:function(){if(n.serverError!=undefined)window.location.href="/Home/HomePage";else{var t=$("#DtlsToggleIconSearchPara").attr("class");t=="fa fa-minus-square-o fa-pull-left fa-2x"&&$("#DtlsSearchParaListCollapse").trigger("click");$("#ScannedFileLogTableID").DataTable().clear().destroy()}}});else{var t=$("#DtlsToggleIconSearchPara").attr("class");t=="fa fa-plus-square-o fa-pull-left fa-2x"&&$("#DtlsSearchParaListCollapse").trigger("click")}return unBlockUI(),n.data},error:function(){bootbox.alert({message:'<i class="fa fa-exclamation-triangle text-danger boot-icon boot-icon"><\/i><span class="boot-alert-txt">Error in Processing<\/span>',callback:function(){}});unBlockUI()},beforeSend:function(){var t,i;return blockUI("loading data.. please wait..."),t=$("#ScannedFileLogTableID_filter input").val(),t!=""&&(i=/^[^<>]+$/,!i.test(t))?($("#ScannedFileLogTableID_filter input").prop("disabled",!0),bootbox.alert("Please enter valid Search String ",function(){n.search("").draw();$("#ScannedFileLogTableID_filter input").prop("disabled",!1)}),unBlockUI(),!1):void 0}},serverSide:!0,scrollX:!0,scrollY:"300px",scrollCollapse:!0,bPaginate:!0,bLengthChange:!0,bInfo:!0,info:!0,bFilter:!1,searching:!0,destroy:!0,bAutoWidth:!0,bScrollAutoCss:!0,columnDefs:[],columns:[{data:"FRN",searchable:!0,visible:!0,name:"FRN"},{data:"SroName",searchable:!0,visible:!0,name:"SroName"},{data:"FileName",searchable:!0,visible:!0,name:"FileName"},{data:"Filepath",searchable:!0,visible:!0,name:"Filepath"},{data:"DownloadedBY",searchable:!0,visible:!0,name:"DownloadedBY"},{data:"DownloadReason",searchable:!0,visible:!0,name:"DownloadReason"},{data:"DownloadDateTime",searchable:!0,visible:!0,name:"DownloadDateTime"}],fnInitComplete:function(){},preDrawCallback:function(){unBlockUI()},fnRowCallback:function(n){return unBlockUI(),n},drawCallback:function(){unBlockUI()}})}function loadModal(){var n=ValidateParameters();n&&$.ajax({url:"/Utilities/ScannedFileDownload/ValidateParameters",data:{SROfficeID:SROfficeID,DROfficeID:DROfficeID,DocumentNumber:DocumentNumber,BookTypeID:BookTypeID,FinancialYear:FinancialYear,DType:DType,MarriageTypeID:MarriageTypeID,DownloadReasonID:DownloadReasonID,DocumentTypeID:DocumentTypeID},type:"GET",success:function(n){n.success==!0?(blockUI("loading.. please wait..."),$.ajax({url:"/Home/IsMobileNumberVerified",type:"GET",success:function(n){n.success==!0?$.ajax({type:"GET",url:"/Home/InputOTPFromUser",success:function(t){t.success?$.ajax({url:"/Home/LoadModal",type:"GET",success:function(n){$("#divOTPValidationModal").modal({backdrop:"static",keyboard:!1});$("#divOTPInput").show();$("#OTPID").focus();$("#divLoadOTPValidation").html(n);$("#divForMessageResend").show();$("#OTPValidationFormId").append('<input type="hidden" id="IsOTPSent" name="IsOTPSent" value="'+t.IsOTPSent+'"><input type="hidden" id="OTPTypeId" name="OTPTypeId" value="'+t.OTPTypeId+'"><input type="hidden" id="EncryptedUId" name="EncryptedUId" value="'+t.EncryptedUId+'">');$("#MobileNumbertoDisplayID").html(t.MobileNumberToDisplay);$("#divOTPValidationModal").modal("show");unBlockUI();$("#CLPP").click(function(){$("#divOTPValidationModal").modal("hide")})},error:function(){bootbox.alert({message:'<i class="fa fa-exclamation-triangle text-danger boot-icon boot-icon"><\/i><span class="boot-alert-txt">Error occured while processing your request<\/span>',callback:function(){}})}}):(unBlockUI(),n.message==undefined?bootbox.alert({message:'<i class="fa fa-exclamation-triangle text-danger boot-icon boot-icon"><\/i><span class="boot-alert-txt">Something went wrong while processing your request .<\/span>',callback:function(){window.location.href="/Error/SessionExpire"}}):bootbox.alert({message:'<i class="fa fa-exclamation-triangle text-danger boot-icon boot-icon"><\/i><span class="boot-alert-txt">'+n.message+"<\/span>",callback:function(){$("#divOTPValidationModal").modal("hide")}}))},error:function(){bootbox.alert({message:'<i class="fa fa-exclamation-triangle text-danger boot-icon boot-icon"><\/i><span class="boot-alert-txt">Error occured while processing your request<\/span>',callback:function(){}})}}):(unBlockUI(),bootbox.alert('<span class="boot-alert-txt"><i class="fa fa-exclamation-triangle text-danger boot-icon boot-icon"><\/i>Mobile Number not verified. Please verify it first.<\/span>'))},error:function(n){alert(n)}})):(unBlockUI(),bootbox.alert('<i class="fa fa-exclamation-triangle text-danger boot-icon boot-icon"><\/i><span class="boot-alert-txt">'+n.errorMessage+"<\/span>",function(){}))},error:function(){alert("Error Occured while processing...");unBlockUI()}})}function ValidateOTP(){$.trim($("#OTPID").val())==""&&bootbox.alert({message:'<i class="fa fa-exclamation-triangle text-danger boot-icon boot-icon"><\/i><span class="boot-alert-txt">Please Enter OTP <\/span>',callback:function(){}});$.trim($("#OTPID").val())!=""&&$.ajax({url:"/Home/GetSessionSalt",type:"GET",async:!1,cache:!1,success:function(n){if(n.success&&n.dataMessage!=null){var t=n.dataMessage,i=hex_sha512($("#OTPID").val()),r=i+rstr2hex(t).toUpperCase(),u=hex_sha512(r);$("#OTPID").val(u);$.ajax({type:"POST",url:"/Home/ValidateOTP",headers:header,data:$("#OTPValidationFormId").serialize(),dataType:"json",success:function(n){n.success?bootbox.alert({message:'<i class="fa fa-check text-success boot-icon"><\/i><span class="boot-alert-txt">'+n.msg+"<\/span>",callback:function(){$("#divOTPValidationModal").modal("hide");ScannedFileDownload()}}):n.msg==undefined?bootbox.alert({message:'<i class="fa fa-exclamation-triangle text-danger boot-icon boot-icon"><\/i><span class="boot-alert-txt">Something went wrong while processing your request .<\/span>',callback:function(){window.location.href="/Error/SessionExpire";$.unblockUI()}}):bootbox.alert({message:'<i class="fa fa-exclamation-triangle text-danger boot-icon boot-icon"><\/i><span class="boot-alert-txt">'+n.msg+"<\/span>",callback:function(){$("#divOTPValidationModal").css("display","block");$("#OTPID").val("");$("#OTPID").focus()}})},error:function(){bootbox.alert({message:'<i class="fa fa-exclamation-triangle text-danger boot-icon boot-icon"><\/i><span class="boot-alert-txt">Error occured while processing your request<\/span>',callback:function(){$("#divOTPValidationModal").modal("show")}})}})}},error:function(){bootbox.alert({message:'<i class="fa fa-exclamation-triangle text-danger boot-icon boot-icon"><\/i><span class="boot-alert-txt">Error occured while processing your request<\/span>',callback:function(){}})}})}function ScannedFileDownload(){SROfficeID=$("#SROfficeListID option:selected").val();DROfficeID=$("#DROfficeListID option:selected").val();DocumentNumber=$("#txtDocumentNumber").val();BookTypeID=$("#BookTypeListID option:selected").val();MarriageTypeID=$("#MarriageTypeListID option:selected").val();NoticeTypeListID=$("#NoticeTypeListID option:selected").val();FinancialYear=$("#FinancialYearListID option:selected").val();DownloadReasonID=$("#DownloadReasonId option:selected").val();DocumentTypeID=$("#DocumentTypeId option:selected").val();DType=$("input[name='DType']:checked").val();var t=new RegExp("^[0-9]*$"),n=ValidateParameters();n&&(blockUI("loading data.. please wait..."),$.ajax({url:"/Utilities/ScannedFileDownload/DownloadScannedFile",data:{SROfficeID:SROfficeID,DROfficeID:DROfficeID,DocumentNumber:DocumentNumber,BookTypeID:BookTypeID,FinancialYearStr:FinancialYear,DType:DType,ReasonID:DownloadReasonID,DocumentTypeID:DocumentTypeID,MarriageTypeID:MarriageTypeID,NoticeTypeListID:NoticeTypeListID},type:"GET",success:function(n){if(unBlockUI(),n.success==!1){$.unblockUI();bootbox.alert('<i class="fa fa-exclamation-triangle text-danger boot-icon boot-icon"><\/i><span class="boot-alert-txt">'+n.message+"<\/span>",function(){});return}n.TiffConversionError?GetCorrectedPDF(n.FinalRegistrationNumber,n.CompromisedTiffFilePath,n.ReferenceString):saveByteArray(n.FileName,base64ToArrayBuffer(n.FileContent));$.unblockUI()},error:function(){unBlockUI();alert("Error Occured while processing...");unBlockUI()}}))}function saveByteArray(n,t){var u=new Uint8Array(t),f=new Blob([u],{type:""}),i=document.createElement("a"),r;i.href=window.URL.createObjectURL(f);r=n;i.download=r;i.click();SaveDownloadDetails()}function base64ToArrayBuffer(n){for(var f,i=window.atob(n),r=i.length,u=new Uint8Array(r),t=0;t<r;t++)f=i.charCodeAt(t),u[t]=f;return u}function ValidateParameters(){var n;return(SROfficeID=$("#SROfficeListID option:selected").val(),DROfficeID=$("#DROfficeListID option:selected").val(),DocumentNumber=$("#txtDocumentNumber").val(),BookTypeID=$("#BookTypeListID option:selected").val(),MarriageTypeID=$("#MarriageTypeListID option:selected").val(),NoticeTypeListID=$("#NoticeTypeListID option:selected").val(),FinancialYear=$("#FinancialYearListID option:selected").val(),DownloadReasonID=$("#DownloadReasonId option:selected").val(),DocumentTypeID=$("#DocumentTypeId option:selected").val(),DType=$("input[name='DType']:checked").val(),n=new RegExp("^[0-9]*$"),DocumentTypeID==0)?(bootbox.alert({message:'<i class="fa fa-exclamation-triangle text-danger boot-icon boot-icon"><\/i><span class="boot-alert-txt">Please select valid Document Type<\/span>'}),!1):SROfficeID==0||DROfficeID==0?(bootbox.alert({message:'<i class="fa fa-exclamation-triangle text-danger boot-icon boot-icon"><\/i><span class="boot-alert-txt">Please select valid Office Details<\/span>'}),!1):(DocumentNumber==""||DocumentNumber==0)&&DocumentTypeID==1?(bootbox.alert({message:'<i class="fa fa-exclamation-triangle text-danger boot-icon boot-icon"><\/i><span class="boot-alert-txt">Please enter valid Document Number<\/span>'}),!1):(DocumentNumber==""||DocumentNumber==0)&&DocumentTypeID==2?(bootbox.alert({message:'<i class="fa fa-exclamation-triangle text-danger boot-icon boot-icon"><\/i><span class="boot-alert-txt">Please enter valid Marriage Case No<\/span>'}),!1):(DocumentNumber==""||DocumentNumber==0)&&DocumentTypeID==3?(bootbox.alert({message:'<i class="fa fa-exclamation-triangle text-danger boot-icon boot-icon"><\/i><span class="boot-alert-txt">Please enter valid Notice Number<\/span>'}),!1):n.test(DocumentNumber)||DocumentTypeID!=1?n.test(DocumentNumber)||DocumentTypeID!=2?n.test(DocumentNumber)||DocumentTypeID!=3?BookTypeID==0&&DocumentTypeID==1?(bootbox.alert({message:'<i class="fa fa-exclamation-triangle text-danger boot-icon boot-icon"><\/i><span class="boot-alert-txt">Please select valid Book Type<\/span>'}),!1):MarriageTypeID==0&&DocumentTypeID==2?(bootbox.alert({message:'<i class="fa fa-exclamation-triangle text-danger boot-icon boot-icon"><\/i><span class="boot-alert-txt">Please select valid Marriage Type<\/span>'}),!1):NoticeTypeListID==0&&DocumentTypeID==3?(bootbox.alert({message:'<i class="fa fa-exclamation-triangle text-danger boot-icon boot-icon"><\/i><span class="boot-alert-txt">Please select valid Notice Type<\/span>'}),!1):FinancialYear==""||FinancialYear=="Select"?(bootbox.alert({message:'<i class="fa fa-exclamation-triangle text-danger boot-icon boot-icon"><\/i><span class="boot-alert-txt">Please select valid Financial Year<\/span>'}),!1):DownloadReasonID==0?(bootbox.alert('<i class="fa fa-exclamation-triangle text-danger boot-icon boot-icon"><\/i><span class="boot-alert-txt">Please Select Download Reason<\/span>',function(){}),!1):DType==null?(bootbox.alert('<i class="fa fa-exclamation-triangle text-danger boot-icon boot-icon"><\/i><span class="boot-alert-txt">Please select Download type<\/span>',function(){}),!1):DocumentTypeID==0||DocumentTypeID==null||DocumentTypeID==undefined?(bootbox.alert('<i class="fa fa-exclamation-triangle text-danger boot-icon boot-icon"><\/i><span class="boot-alert-txt">Please select Document type<\/span>',function(){}),!1):!0:(bootbox.alert({message:'<i class="fa fa-exclamation-triangle text-danger boot-icon boot-icon"><\/i><span class="boot-alert-txt">Please enter valid Notice Number<\/span>'}),!1):(bootbox.alert({message:'<i class="fa fa-exclamation-triangle text-danger boot-icon boot-icon"><\/i><span class="boot-alert-txt">Please enter valid Marriage Case No<\/span>'}),!1):(bootbox.alert({message:'<i class="fa fa-exclamation-triangle text-danger boot-icon boot-icon"><\/i><span class="boot-alert-txt">Please enter valid Document Number<\/span>'}),!1)}function GetCorrectedPDF(n,t,i){$.blockUI({message:'<img src="/Content/images/ajax-loader.gif"/>'});$("#FinalRegistrationNumber").val(n);$("#ReferenceString").val(i);var r=new XMLHttpRequest;r.open("GET",t);r.responseType="arraybuffer";r.onload=imgLoaded;r.send()}function loadOne(){var r,n,u,f,t,i;$.blockUI({message:'<img src="/Content/images/ajax-loader.gif"/>'});try{UTIF.decodeImage(resp,pages[p])}catch(e){if(e=="JpegError: JPEG error: SOI not found"){ConvertToPDFUsingImageMagick();return}}for(r=UTIF.toRGBA8(pages[p]),n=document.createElement("canvas"),n.width=pages[p].width,n.height=pages[p].height,u=n.getContext("2d"),f=u.createImageData(n.width,n.height),t=0;t<r.length;t++)f.data[t]=r[t];u.putImageData(f,0,0);IDs.push(n.toDataURL());i=document.createElement("img");i.src=n.toDataURL("image/png");i.setAttribute("width",n.width);i.setAttribute("height",n.height);++p<pages.length&&(i.onload=loadOne);p==pages.length&&ConvertToTIFF()}function imgLoaded(n){$.blockUI({message:'<img src="/Content/images/ajax-loader.gif"/>'});resp=n.target.response;pages=UTIF.decode(resp);console.log(pages);p=0;loadOne()}function ConvertToTIFF(){var n=[],t=0,i;$.each(IDs,function(i,r){n[t]=r;t++});i={BaseImageList:n,FinalRegistrationNumber:$("#FinalRegistrationNumber").val(),ReferenceString:$("#ReferenceString").val()};$.ajax({type:"POST",url:"/Utilities/ScannedFileDownload/GetCorrectedPDFFileName",data:i,dataType:"json",cache:!1,success:function(n){if($.unblockUI(),n.success==!1){bootbox.alert('<i class="fa fa-exclamation-triangle text-danger boot-icon boot-icon"><\/i><span class="boot-alert-txt">'+n.message+"<\/span>",function(){});return}saveByteArray(n.FileName,base64ToArrayBuffer(n.FileContent))},traditional:!0})}function ConvertToPDFUsingImageMagick(){var n={FinalRegistrationNumber:$("#FinalRegistrationNumber").val(),ReferenceString:$("#ReferenceString").val()};$.ajax({type:"POST",url:"/Utilities/ScannedFileDownload/ConvertToPDFUsingImageMagick",data:n,dataType:"json",cache:!1,success:function(n){$.unblockUI();n.success?saveByteArray(n.FileName,base64ToArrayBuffer(n.FileContent)):(bootbox.alert('<i class="fa fa-exclamation-triangle text-danger boot-icon boot-icon"><\/i><span class="boot-alert-txt">Some Error Occurred please try again later.<\/span>',function(){}),$.unblockUI())},traditional:!0})}function SaveDownloadDetails(){SROfficeID=$("#SROfficeListID option:selected").val();DROfficeID=$("#DROfficeListID option:selected").val();DocumentNumber=$("#txtDocumentNumber").val();BookTypeID=$("#BookTypeListID option:selected").val();MarriageTypeID=$("#MarriageTypeListID option:selected").val();NoticeTypeListID=$("#NoticeTypeListID option:selected").val();FinancialYear=$("#FinancialYearListID option:selected").val();DownloadReasonID=$("#DownloadReasonId option:selected").val();DocumentTypeID=$("#DocumentTypeId option:selected").val();DType=$("input[name='DType']:checked").val();$.ajax({url:"/Utilities/ScannedFileDownload/SaveScannedFileDownloadDetails",data:{SROfficeID:SROfficeID,DROfficeID:DROfficeID,DocumentNumber:DocumentNumber,BookTypeID:BookTypeID,FinancialYearStr:FinancialYear,DType:DType,ReasonID:DownloadReasonID,DocumentTypeID:DocumentTypeID,MarriageTypeID:MarriageTypeID,NoticeTypeListID:NoticeTypeListID},type:"Post",success:function(){unBlockUI();LoadDT()},error:function(){unBlockUI();alert("Error Occured while processing...");unBlockUI()}})}var token="",header={},test=0,pages,p,resp,DataForCorrectedPDF,IDs=[];$(document).ready(function(){token=$("[name=__RequestVerificationToken]").val();header.__RequestVerificationToken=token;$("#DtlsSearchParaListCollapse").click(function(){var n=$("#DtlsToggleIconSearchPara").attr("class"),t=n=="fa fa-plus-square-o fa-pull-left fa-2x"?"fa fa-minus-square-o fa-pull-left fa-2x":"fa fa-plus-square-o fa-pull-left fa-2x";$("#DtlsToggleIconSearchPara").removeClass(n).addClass(t)});LoadDT();$("#DROfficeListID").change(function(){blockUI("loading data.. please wait...");$.ajax({url:"/Utilities/ScannedFileDownload/GetSROOfficeListByDistrictID",data:{DistrictID:$("#DROfficeListID").val()},type:"GET",success:function(n){n.serverError==!0?bootbox.alert('<i class="fa fa-exclamation-triangle text-danger boot-icon boot-icon"><\/i><span class="boot-alert-txt">'+n.errorMessage+"<\/span>",function(){window.location.href="/Home/HomePage"}):($("#SROfficeListID").empty(),$.each(n.SROfficeList,function(n,t){t;$("#SROfficeListID").append('<option value="'+t.Value+'">'+t.Text+"<\/option>")}));unBlockUI()},error:function(){unBlockUI()}})});$("#MarriageTypeListID").hide();$("#NoticeTypeListID").hide();$("#DocumentTypeId").change(function(){$("#DocumentTypeId").val()=="1"?($("#MarriageTypeListID").hide(),$("#NoticeTypeListID").hide(),$("#BookTypeListID").show(),$("#lblDocNo").html('<label class="PaddingTop10" for="DocumentNumber" style="padding-left:4px;">Document Number<\/label><label style="color:red">*<\/label>\n')):$("#DocumentTypeId").val()=="2"?($("#MarriageTypeListID").show(),$("#BookTypeListID").hide(),$("#NoticeTypeListID").hide(),$("#lblDocNo").html('<label class="PaddingTop10" for="DocumentNumber" style="padding-left:4px;">Marriage Case No<\/label><label style="color:red">*<\/label>\n')):($("#BookTypeListID").hide(),$("#MarriageTypeListID").hide(),$("#NoticeTypeListID").show(),$("#lblDocNo").html('<label class="PaddingTop10" for="DocumentNumber" style="padding-left:4px;">Notice Number<\/label><label style="color:red">*<\/label>\n'))})});