function gridTojson(){var n=[],t=$("#WebGrid tbody tr").each(function(t){if($(this)[0].rowIndex!=0){x=$(this).children();var i=[];x.each(function(){$(this).children("input").length>0&&($(this).children("input").val()=="",enhancementsFixedBugsInputRules.test($(this).children("input").val())?i.push('"'+$(this).children("input").val()+'"'):bootbox.alert("❌ One of the Values in the Modification Details is invalid."));$(this).children("select").length>0&&i.push('"'+$(this).children("select").val()+'"')});n.push('"'+t+'": ['+i.join(",")+"]")}});return"{"+(n.join(",")+"}")}function UpdateServicePackDetails(n){var i,r,u,t,f,e;if($("#lstReleaseTypes").val()==0){bootbox.alert("Please Select Release Type");return}if($("#onlyMajorNumber").val()==""){bootbox.alert("Major Version is needed");return}if($("#onlyMinorNumber").val()==""){bootbox.alert("Minor Version is needed");return}if($("#txtServicePackDesc").val()==""){bootbox.alert("Service Pack Description is needed");return}if($("#txtInstallationProcedure").val()==""){bootbox.alert("Installation Procedure is needed");return}if(i=new RegExp("^[a-zA-Z0-9-/., ]+$"),r=i.test($("#txtServicePackDesc").val()),!r){bootbox.alert("Invalid Description");return}if(u=i.test($("#txtInstallationProcedure").val()),!u){bootbox.alert("Invalid Installation Procedure");return}if(event.preventDefault(),t=new FormData,f=document.getElementById("UploadReleaseFile").files[0],$("#IsFileToUpdateID").val()=="true"&&FileSizeForValidation>40){bootbox.alert("Please Upload file size less than 40 MB!");return}t.append("IsFileToUpdateID",$("#IsFileToUpdateID").val());t.append("ReleaseType",$("#lstReleaseTypes").val());t.append("File",f);t.append("SpID",$("#spID").val());t.append("Major",$("#onlyMajorNumber").val());t.append("Minor",$("#onlyMinorNumber").val());t.append("FinalTestValue",$('[name="ServicePackDetails.IsTestOrFinal"]:checked').val());t.append("IsActiveValue",$('[name="ServicePackDetails.IsActive"]:checked').val());t.append("ServicePackDescription",$("#txtServicePackDesc").val());t.append("InstallationProcedure",$("#txtInstallationProcedure").val());t.append("BugsList",n);t.append("GridCount",countofGrid);e=$("[name=__RequestVerificationToken]").val();t.append("__RequestVerificationToken",e);$.ajax({url:"/ServicePack/ServicePackDetails/UpdateServicePackDetails",type:"POST",data:t,contentType:!1,processData:!1,success:function(n){n.serverError==!0&&n.success==!1?(n.message!=null||n.message!="")&&bootbox.alert({message:n.message,callback:function(){window.location.href="/Home/HomePage"}}):($(".ClsServicePackReleaseFiles").val(""),n.success?bootbox.alert({message:n.message,callback:function(){window.location.href="/ServicePack/ServicePackDetails/AddServicePackDetailsHome"}}):n.success==!1&&bootbox.alert(n.message))},error:function(){bootbox.alert({message:'<i class="fa fa-exclamation-triangle text-danger boot-icon boot-icon"><\/i><span class="boot-alert-txt">Error in Processing<\/span>'})}})}function DeleteServicePackChangeEntry(n){$.ajax({url:"/ServicePack/ServicePackDetails/ServicePackChangesDetailsEntry",type:"POST",datatype:"json",async:!1,cache:!1,data:{id:n},success:function(n){n.serverError==!0&&n.success==!1?(n.message!=null||n.message!="")&&bootbox.alert(n.message,function(n){n&&(window.location.href="/Home/HomePage")}):n.success==!0?bootbox.alert(n.message,function(){window.location.reload()}):bootbox.alert(n.message)},error:function(){bootbox.alert({message:'<i class="fa fa-exclamation-triangle text-danger boot-icon boot-icon"><\/i><span class="boot-alert-txt">Error in Processing<\/span>'})}})}function clearFile(){$(".ClsServicePackReleaseFiles").val("");$("#Upload-filename").text("");$("#IsFileToUpdateID").val("false");$("span.spnClear").hide();$("#spn").html("")}var bugsList=[],enhancementsFixedBugsInputRules=/^[a-zA-Z0-9-/., ]+$/,majorversionInput=new RegExp("^(?:[1-9] | 0[1-9]|10)$"),minorversionInput=new RegExp("^(?:[1-9]|1[1-9]|20)$"),changesModificationslist="<select class = 'form-control minimal dropdown-toggle' id='abc'><option value=\"1\">Bugs<\/option><option value=\"2\">Enhancements<\/option><\/select>",_griddata,countofGrid=0,FileSizeForValidation=0;$(function(){var n=$("#WebGrid tr").length;$("#add").on("click",function(){$("table").append("<tr id="+n+++"><td>N/A<\/td><td><input name='title' id='Name' style=\"width: -moz-available;\"/><\/td><td id='ddlChangeType' >"+changesModificationslist+'<\/td><td><button class="btn btn-danger theButton" title="Click here to delete Changes/Modification Type entry">Delete<\/button><\/td>NaN')});$(".edit-mode").hide();$(".edit-user, .cancel-user").on("click",function(){var n=$(this).parents("tr:first");n.find(".edit-mode, .display-mode").toggle();$(this).hasClass("edit-user")&&n.find("td:eq(2)").find("select").removeAttr("disabled");$(this).hasClass("cancel-user")&&n.find("td:eq(2)").find("select").prop("disabled","disabled")});$("body").on("click",function(){}).on("click","button.theButton",function(){$(this).parents("tr").remove()});$(".save-user").on("click",function(){var n=$(this).parents("tr:first"),t=n.find("#Name").val(),i=n.find("#ddlChangeType").val();if(!t){bootbox.alert("Invalid Input");return}if(enhancementsFixedBugsInputRules.test(t))n.find("#lblName").text(t),n.find("#lblSurName").text(i),n.find(".edit-mode, .display-mode").toggle();else{bootbox.alert("Invalid Input");return}n.find("td:eq(2)").find("select").prop("disabled","disabled")});$("#btnClose").click(function(){window.location.href="/ServicePack/ServicePackDetails/AddServicePackDetailsHome"});$("#btnEditServicePackDetails").click(function(){_griddata=gridTojson();countofGrid=$("#WebGrid tr").length-1;UpdateServicePackDetails(_griddata)});$(".delete").click(function(){var t=$(this).attr("id").split("_"),n;(id=t[1],n=confirm("Are you sure to delete ??"),id!=""&&n!=!1)&&DeleteServicePackChangeEntry(id)});$("#onlyMajorNumber").keypress(function(n){if(n.which!=8&&n.which!=0&&(n.which<48||n.which>57))return $("#errmsg").html("only number allowed").show().fadeOut("slow"),!1;majorversionInput.test($("#onlyMajorNumber").val())||$("#errmsg").html("❌ Input between 1 to 10").show().fadeOut("slow");$("#onlyMajorNumber").val()<1&&$("#errmsg").html("❌ Negative values are not allowed").show().fadeOut("slow")});$("#onlyMinorNumber").keypress(function(n){if(n.which!=8&&n.which!=0&&(n.which<48||n.which>57))return $("#errmsg").html("❌ only number allowed").show().fadeOut("slow"),!1;minorversionInput.test($("#onlyMajorNumber").val())||$("#errmsg").html("❌ Input between 1 to 20").show().fadeOut("slow");$("#onlyMinorNumber").val()<0&&$("#errmsg").html("❌ Negative values are not allowed").show().fadeOut("slow")});$(".ClsServicePackReleaseFiles").change(function(){var r,t,i,n;if($("span.spnClear").hide(),r=["zip","ZIP"],$(".ClsServicePackReleaseFiles").val()=="")return!1;if($.inArray($(this).val().split(".").pop().toLowerCase(),r)==-1)return bootbox.alert("Only Zip Files Are Allowed!!"),$(this).val(""),$("span.spnClear").hide(),$("#IsFileToUpdateID").val("false"),!1;t=$(this).val();$("#Upload-filename").text(t.substring(t.lastIndexOf("\\")+1,t.length));i=document.getElementById(this.id).files.item(0);n=i.size/1048576;n=n.toFixed(2);$("span.spnClear").show();$("#IsFileToUpdateID").val("true");FileSizeForValidation=n;n==0?(n=i.size/1024,$("#spn").text("File Size: "+n.toFixed(2)+" KB    ")):$("#spn").text("File Size: "+n+" MB    ")});ReleaseTypeID==3?($("#rdoNFinal").attr("disabled","disabled"),$("#rdoYTest").attr("disabled","disabled"),$("#rdoNSupport").prop("checked",!0),$("#rdoNSupport").removeAttr("disabled")):($("#rdoNFinal").removeAttr("disabled"),$("#rdoYTest").removeAttr("disabled"),$("#rdoNSupport").attr("disabled","disabled"),$("#rdoNSupport").prop("checked",!1),ReleaseTypeID==1&&$("#rdoYTest").prop("checked",!0),ReleaseTypeID==2&&$("#rdoNFinal").prop("checked",!0))});